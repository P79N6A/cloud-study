<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ls.cloud.bookservice.dao.BookChapterDao">

    <insert id="insertOrUpdate">
        INSERT INTO  ${tableName}(
            `title`,`url`,`content`,
            `order`,`source`
        )
        VALUES
            (#{title},#{url},#{content},
            #{order},#{source})
        on DUPLICATE KEY update url=#{url},source=#{source},content=#{content}
    </insert>


    <select id="createIfNotExist">
        CREATE TABLE
        IF NOT EXISTS ${table_name} (
            `title` VARCHAR (80) NOT NULL,
            `url` VARCHAR (255) NULL,
            `content` text NULL,
            `order` int (6) NULL,
            `source` VARCHAR (255) NULL,
            `update_time` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
            PRIMARY KEY (`title`),
            INDEX `order_index` (`order`)
            )
	</select>
    <select id="queryBookChapters" resultType="com.ls.cloud.bookservice.entity.BookChapter">
        SELECT
            title,`order`,url
        FROM
            book_${bookId}
        ORDER BY `order`
    </select>
    <select id="queryBookChapter" resultType="com.ls.cloud.bookservice.entity.BookChapter">
        SELECT
            title,`order`,url,content
        FROM
            book_${bookId}
        where `order`=#{order}
    </select>

</mapper>